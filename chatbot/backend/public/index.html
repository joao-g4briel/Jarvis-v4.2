<!DOCTYPE html>
<html>
<head>
	<title>Login - ChatBot</title>
	<style>
		body { font-family: Arial, sans-serif; max-width: 400px; margin: 50px auto; padding: 20px; }
		input, button { width: 100%; padding: 10px; margin: 10px 0; }
		a { color: blue; text-decoration: none; }
	</style>
</head>
<body>
	<h2>Login</h2>
	<div id="loginForm">
		<input type="text" id="loginUsername" placeholder="Username">
		<input type="password" id="loginPassword" placeholder="Password">
		<button onclick="login()">Login</button>
		<p>Não tem conta? <a href="#" onclick="showRegister()">Registre-se</a></p>
	</div>

	<div id="registerForm" style="display:none;">
		<h2>Registro</h2>
		<input type="text" id="regUsername" placeholder="Username">
		<input type="password" id="regPassword" placeholder="Password">
		<button onclick="register()">Registrar</button>
		<p>Já tem conta? <a href="#" onclick="showLogin()">Faça login</a></p>
	</div>

	<script>
		function showRegister() {
			document.getElementById('loginForm').style.display = 'none';
			document.getElementById('registerForm').style.display = 'block';
		}

		function showLogin() {
			document.getElementById('registerForm').style.display = 'none';
			document.getElementById('loginForm').style.display = 'block';
		}

		// Detecta ambiente e define a URL base do backend
		const backendUrl = (window.location.hostname.includes('localhost') || window.location.hostname === '127.0.0.1')
			? 'http://localhost:3000'
			: 'https://wggks448w0wok8okwo0ww4w0.coolify.dtecchat.qzz.io';

		async function register() {
			const username = document.getElementById('regUsername').value;
			const password = document.getElementById('regPassword').value;

			const res = await fetch(`${backendUrl}/register`, {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ username, password })
			});

			const data = await res.json();
			if (res.ok) {
				alert('Registrado com sucesso! Faça login.');
				showLogin();
			} else {
				alert(data.error);
			}
		}

		async function login() {
			const username = document.getElementById('loginUsername').value;
			const password = document.getElementById('loginPassword').value;

			const res = await fetch(`${backendUrl}/login`, {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ username, password })
			});

			const data = await res.json();
			if (res.ok) {
				localStorage.setItem('userId', data.userId);
				window.location.href = 'chat.html';
			} else {
				alert(data.error);
			}
		}
	</script>
</body>
</html>
(placeholder)
